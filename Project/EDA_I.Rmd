---
title: "EDA I"
output:
        bookdown::html_document2: default
        
---

<style>
p.caption {
  font-size: 1.3em;
  font-weight:bold;
  text-align:center;
  color: black;
}
</style>

# Data Understanding

Going forward with the anaylisis, the goal in the second step is to have a first perception of the information brought by the data and create hypotheses about them. 

## Collect initial data

The dataset was delivered together with the description of the task and it is in *csv format*. It contains 1'000 observations, 1 each row, 30 input variables and 1 output variable. 
In addition to the dataset, we seek for more information in videos in youtube where we were mainly intended to familiarize with the operation of credit selection itself and, hence, indeep more into the variables that we consider that are bringing the most information. 

## Describe data

In this point, we will examine the gross properties of the adquire data. Let's start checking the stucture and size of it. As you can see below, there are 1'000 rows and 32 variables. The first column identifies all the observations taken into consideration with an unique ID (a number), the 30 following columns are the input variables, while the last one is the output variable, which gives the information regarding the person is a high risk (the credit is rejected) or not (the credit is accepted).

```{r, echo=TRUE, message=FALSE, warning=FALSE}

dim(data)

```

Now, let's give a look to the summary and the structure of the data, including their statistical characteristics, for example, minimum, mean, maximum, so on. 

### {.tabset .tabset-fade .tabset-pills}

Overview of the dataset (1000 observations):  

#### Summary

```{r , echo=FALSE, message=FALSE, warning=FALSE}

summarydata<- print(summarytools::dfSummary(data, valid.col = FALSE, 
                                    graph.magnif = 0.75),       
                                    max.tbl.height = 300, method = "render")

summarydata

```

#### Output variable: yes / no

```{r echo=FALSE, message=FALSE, warning=FALSE}

data %>% 
  ggplot(aes(x = RESPONSE)) + 
  geom_bar(aes(fill = factor(RESPONSE))) + 
  labs(color = "", fill = "") + 
    geom_label(stat = 'count', aes(label =..count..)) +
    theme_bw()+
    theme(legend.title = element_blank()) + 
    theme(plot.title = element_text(face = "bold",  hjust = 0.5)) +
    labs(title = "Output Variable",  
           x = "Response [no=0 /yes=1]", y = "Count (by unit)")

```

As we can see from the graph, there is a majority of the observations having a positive value (700 against 300).

#### Description by output variable

```{r echo=FALSE, message=FALSE, warning=FALSE}

psych::describeBy(data, data$RESPONSE)

```

### {.toc-ignore}

As we see in the table shown above, all the values are integers and there is not any missing value. In addition, we can see some inconsistencies of the variables with the initial description, that we will explain in following table.

| Variable   | Description   | Inconsistencies                                                 |
| :---------:|:--------------|:----------------------------------------------------------------|
| CHK_ACCT   |  C: 0, 1, 2, 3    | X  |
| DURATION |  Numerical    | X  |
| HISTORY |  C: 0, 1, 2, 3, 4 | X  |
| NEW_CAR  |  B: 0, 1  | X  |
| USED_CAR |  B: 0, 1	  | X  |
| FURNITURE |  B: 0, 1    | X  |
| RADIO.TV  |  B: 0, 1   | X  |
| EDUCATION |  B: 0, 1   | ✔: Acoording to the description we should have a binary variable and the data show -1 |
| RETRAINING  |  B: 0, 1| X  |
| AMOUNT      |  Numerical | X  |
| SAV_ACCT    |  C: 0, 1, 2, 3, 4 | X  |
| EMPLOYMENT  |  C: 0, 1, 2, 3, 4 | X  |
| INSTALL_RATE |  Numerical| X  |
| MALE_DIV |  B: 0, 1 | X  |
| MALE_SINGLE	|  B: 0, 1 | X  |
| MALE_MAR_WID |  B: 0, 1 | X  |
| CO-APPLICANT |  B: 0, 1 | X  |
| GUARANTOR   |  B: 0, 1 |  ✔: Acoording to the description we should have a binary variable and the data show a 2 |
| PRESENT_RESIDENT|  C: 0, 1, 2, 3| ✔: Acoording to the description we should 3 categories instead of 4 shown by the data|
| REAL_ESTATE |  B: 0, 1| X  |
| PROP_UNKN_NONE  |  B: 0, 1| X  |
| AGE|  Numerical| ✔: Identify outliers, the age should not go up to 125 years |
| OTHER_INSTALL|  B: 0, 1| X  |
| RENT |  B: 0, 1| X  |
| OWN_RES |  B: 0, 1| X  |
| NUM_CREDITS|  Numerical| X  |
| JOB |  C: 0, 1, 2, 3| X  |
| NUM_DEPENDENTS  |  Numerical| X  |
| TELEPHONE  |  B: 0, 1| X  |
| FOREIGN    |  B: 0, 1| X  |

Then, for the 4 inconsistencies we have found, we have establish the following hypothesis and solutions.

- **EDUCATION**: there was an error in the registration of the information and the -1 must be replaced by a 1.
- **GUARANTOR**: there was an error in the registration of the information and the 2 must be replaced by a 1.
- **PRESENT_RESIDENT**: there was an error in the registration of the information and the value was considered in years instead of categories.
- **AGE**: Here it is clear that we have an outlier, we should limit the age to 75.

The corrections will be made in the next section.

It is also important to mention that the output variable shows that in 70% of the cases the credit is accepted and in 30% rejected, which can later bias the prediction.

## Explore data

In this section, we will go deeper into the data and look for patterns or relationships between variables. To be able to do it, we will develop an histogram to check the distribution of our data for each variable.

### Histogram {.tabset .tabset-fade .tabset-pills}

#### All variables

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.asp=2}

x<-inspect_num(data[,-32])
show_plot(x, text_labels = TRUE, 
          alpha = 0.05, high_cardinality = 0,
          plot_layout = NULL,  col_palette=3, 
          plot_type = "bar", label_thresh = 0.1) + theme_bw()

```

#### Of independent variables grouped by response

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.asp=4}

data[,-1] %>% 
  explore_all(target = RESPONSE) + theme_bw()

```

### {.toc-ignore}

Regarding the last charts, we have the following observations:

- We can see that the numerical variables have a normal distribution asymmetric to the right (Skewed (Non-Normal) Right), possibly because we have a more significant lower bound.
- It is very difficult to indentify patterns in the data.
- In the histograms by response variable, we are able to see the proportion within the positives and negatives answers applications. 

### Boxplot {.tabset .tabset-fade .tabset-pills}

Now that we have checked the distribution of the variables, let's move on to the evaluation of their quartiles.

#### All variables

```{r, echo=FALSE, message=FALSE, warning=FALSE}

par(mfrow=c(3,3))
for (i in 1:length(data)) {
        boxplot(data[,i], horizontal = TRUE, pars=list(outcol="red"), 
                main=names(data[i]), type="l")}

```

#### Of independent variables grouped by response

```{r, echo=FALSE , message=FALSE, warning=FALSE}

plot_boxplot(data[,c(-1)], by= 'RESPONSE',  
             ncol = 2,  ggtheme =theme_bw(), 
             title = "Side-by-side boxplots",
             geom_boxplot_args = list("outlier.color" = "red"))

```

### {.toc-ignore}

In the following table, you will find our principal observations. 

| Boxplot          | Observation       |
| :---------------:|:------------------|
| For each variable | We indentified that some variable could be mutually exclusive between them. We can evaluate the formation of the following groups: <br /> 1) Aggregation of the varibles purpose of the credit <br /> 2) Aggregation of the male variables as a categorical one. <br /> 3) Aggregation of the REAL_ESTATE and PROP_UNKN_NONE as a categorical one. <br /> 4) Aggregation of the RENT and OWN_RES as a categorical one. |
| plot by response | The variables which stand out more are: `CHK_ACCT` and `EMPLOYMENT`. We can observe that each box by group is different from the others. | 

Additionally, we could identify some outliers, show as red dots and, as you can see in the second chart. The input variables clustered by the output variable show that there are some features that bring more information than others.   

In the terms of the variables that we can create, we want to give some definitions, which are the following:

**key definitions:** 

1) *Real property includes the physical property (physical land, structures and resources attached to it) of the real estate, but it expands its definition to include other types of ownerships as rights. Meaning that we can have properties without real state (PROP_UNKN_NONE =0 & REAL_ESTATE=0)*
2) *For the RENT and OWN_RES variable, we can see that we have 3 cases: 1-0, 0-1 and 0-0 because there exists the possibility that the person who apply for the loan do not owns the residence and neither is in charge of any rent.*

#### Correlation

Now, we will give a look to the correlation between variables.

```{r, echo=FALSE, fig.asp=1.2, message=FALSE, warning=FALSE}

plot_correlation(data, type= 'c', 
                 cor_args = list( 'use' = 'complete.obs'))        

```

The variables which are the most correlated are the following: 

- **History** and **Number of credits** positively correlated between them.
- **Duration** and **Amount** positively correlated.
- **Response** variable and **check account** positively correlated.

In the model section we will evaluate the coefficients of the variables and continue this analysis in greater depth.

## Verify data quality {.tabset .tabset-fade .tabset-pills}

To be able to do so, we establish 3 questions that we will address during the resolution of this step:

1) Is the data complete (does it cover all the cases required)? 
2) Is it correct or does it contain any error?
3) Are there missing values in the data? If so how are they represented?

### Overall dataset

```{r, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_missing_dataset<-plot_intro(data[,-32],  
                      ggtheme =theme_bw(), 
                      theme_config=theme(legend.position="bottom"))+
                      theme(plot.title = element_text(face = "bold",  hjust = 0.5)) +
                      labs(title = "Missing information over the complete dataset")


```


```{r, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_missing_dataset

```


### By variable

```{r, echo=FALSE,include=FALSE, fig.asp=1.2, message=FALSE, warning=FALSE, paged.print=FALSE}

nrows<-nrow(data)
n.missing<-rowSums(is.na(data))
sum(n.missing > 0)/nrows
n.complete<-sum(complete.cases(data))
n.complete/nrows

plot_missing_variable<- plot_missing(data[,-32],  
           ggtheme =theme_bw(), 
           theme_config=theme(legend.position="bottom"))+
            theme(plot.title = element_text(face = "bold",  hjust = 0.5)) +
            labs(title = "Missing rows information")

#Inspect the NA values

#inspect_na(data[,-32])
inspect_types(data[,-32])

#delete variables
rm(x, i, n.complete, n.missing, nrows)

```

```{r, echo=FALSE, fig.asp=1.2, message=FALSE, warning=FALSE, paged.print=FALSE}

plot_missing_variable
rm(plot_missing_variable, plot_missing_dataset)

```

## {.toc-ignore}

Below you will find the answers of the 3 questions:

| Question    | Answer                                                                | 
| :----------:|:----------------------------------------------------------------------|
| 1           | Yes, all the columns and rows contains information. | 
| 2           | No, they contain some errors. They were found in data description and exploratory and are the following: <br /> 1) The variable EDUCATION shows an output that is not binary. <br /> 2) The variable PRESENT_RESIDENT have more categories than those that were mentioned in the description <br /> 3) the variable AGE is out of range. <br /> 4) AMOUNT, DURANTION, AGE are the variables with the highest quantity of outliers. | 
| 3           | No, there is not any missing values in the data. | 

In addition, we are going to anaylise if the aggregation mentioned in the boxplot for each variable is possible. To do it, we are going to apply the **Chi-Squared Test** to measure the independence between them in the following section. 